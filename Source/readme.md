# Zingularity Source Code

### Jacobi.CpuZ80

The `C` code that contains the core of the Z80 emulator.
Some code files are generated by the .tt files in Jacobi.CpuZ80.Meta.

### Jacobi.CpuZ80.Tests

`CPP`
Unit tests for the Z80 emulator code.

### Jacobi.CpuZ80.Meta

`C#`
Contains the InstructionsZ80.json file that defines all possible Z80 instruction.
This is used as a basis to generate source code.

### Jacobi.CpuZ80.Meta.Tests

`C#`
Unit tests for the meta logic.

## Z80 notes

### Flags

After analysis of the Z80 instrcutions I have found these flag operations including the undocumented ones.

| Flag Operation   | Description   |
|-------------|--------------|
| [ommited] | Flag is unaffected
| [_name] | A custom function is generated for the flag.
| 0 | Flag is always reset.
| 1 | Flag is always set.
| r[b] | Flag set to b'th bit of the result of the instruction.
| rz | Flag is set when the result of the instruction is zero (also 16 bits results).
| ro | Flag is set when the signed result of the instruction overflows (see Z80 manual).
| rp | Flag is set when the parity of the result of the instruction is even.
| c | Flag is set to value of the carry flag.
| c[b] | Flag is set when the there was a carry for the b'th bit. b=[7,3]
| b[b] | Flag is set when the there was a borrow for the b'th bit. b=[8,4]
| ah[b] | Flag set to the b'th bit of the high byte of the resulting address after displacement.
| i | Flag is set to the value of IFF2
| [ABCDEHLIR][b] | Flag set to b'th bit of the register before the instruction is executed.
| [ABCDEHLIR]z | Flag is set when the register is zero before the instruction is executed.
| BC | Flag is set when BC is not zero.
| d[b] | Flag is set to the b'th bit of the data being read/written.
| dz | Flag is set when the data being read/written is zero.
| [00] | Flag is set if the result matches the hex value specified.


Note: Rotate and Shift instructions set the Carry flag as part of the instruction implementation.